<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TimeSphere | Create Clock</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
  body { font-family:'Poppins',sans-serif; margin:0; background: linear-gradient(135deg,#5d54a4,#7c78b8); color:white; overflow-x:hidden; }
  header { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background: rgba(255,255,255,0.1); backdrop-filter: blur(8px); position:fixed; width:100%; top:0; z-index:10; }
  .menu-btn { font-size:2rem; cursor:pointer; transition: transform .3s; } .menu-btn:hover { transform:scale(1.06); }
  .title { font-weight:600; font-size:1.4rem; }
  .right { display:flex; align-items:center; gap:1rem; }
  .clock, .logout-btn { font-weight:600; }
  .logout-btn { cursor:pointer; background: rgba(255,255,255,0.15); padding:0.5rem 1rem; border-radius:8px; transition: background .2s; }
  .logout-btn:hover { background: rgba(255,255,255,0.28); }

  main { margin-top:90px; padding:2rem; display:flex; flex-direction:column; gap:1.5rem; align-items:center; }
  .section { width:90%; max-width:700px; background: rgba(255,255,255,0.1); border-radius:18px; padding:20px; box-shadow: 0 8px 30px rgba(0,0,0,0.25); text-align:center; }

  label { display:block; margin-top:10px; margin-bottom:5px; font-weight:600; }
  input, select { width:100%; padding:0.5rem; border-radius:10px; border:none; outline:none; margin-bottom:1rem; background: rgba(255,255,255,0.2); color:white; }

  #clockPreview { margin:20px auto; display:block; border-radius:50%; background: rgba(255,255,255,0.05); position:relative; }

  button { padding:0.5rem 1rem; border:none; border-radius:10px; cursor:pointer; background: rgba(255,255,255,0.2); color:white; transition:0.3s; }
  button:hover { background: rgba(255,255,255,0.4); }

</style>
</head>
<body>
<header>
  <span class="menu-btn material-icons" id="menuToggle">menu</span>
  <h1 class="title">TimeSphere</h1>
  <div class="right">
    <div class="clock" id="clock">--:--</div>
    <div class="logout-btn" id="logoutBtn">Logout</div>
  </div>
</header>

<main>
  <div class="section">
    <h2>Create Clock</h2>
    <label>Clock Name:</label>
    <input type="text" id="clockNameInput" placeholder="Clock Name" />

    <label>Time Zone:</label>
    <select id="timeZoneSelect">
      <!-- UTC+14 do UTC-12 -->
      <option value="+14">UTC+14</option>
      <option value="+13">UTC+13</option>
      <option value="+12">UTC+12</option>
      <option value="+11">UTC+11</option>
      <option value="+10">UTC+10</option>
      <option value="+9">UTC+9</option>
      <option value="+8">UTC+8</option>
      <option value="+7">UTC+7</option>
      <option value="+6">UTC+6</option>
      <option value="+5">UTC+5</option>
      <option value="+4">UTC+4</option>
      <option value="+3">UTC+3</option>
      <option value="+2">UTC+2</option>
      <option value="+1">UTC+1</option>
      <option value="0">UTC+0</option>
      <option value="-1">UTC-1</option>
      <option value="-2">UTC-2</option>
      <option value="-3">UTC-3</option>
      <option value="-4">UTC-4</option>
      <option value="-5">UTC-5</option>
      <option value="-6">UTC-6</option>
      <option value="-7">UTC-7</option>
      <option value="-8">UTC-8</option>
      <option value="-9">UTC-9</option>
      <option value="-10">UTC-10</option>
      <option value="-11">UTC-11</option>
      <option value="-12">UTC-12</option>
    </select>

    <label>Clock Theme:</label>
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark" selected>Dark</option>
    </select>

    <canvas id="clockPreview" width="250" height="250"></canvas>

    <button id="createBtn">Create Clock and redirect to your clock</button>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiGzil9wA3CXZWxWjHsn7iKPkiYQozQW8",
  authDomain: "timesphere-9f7e0.firebaseapp.com",
  projectId: "timesphere-9f7e0",
  storageBucket: "timesphere-9f7e0.firebasestorage.app",
  messagingSenderId: "94629610195",
  appId: "1:94629610195:web:a037e5c5aa0c5ba7e50a26"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const clockNameInput = document.getElementById('clockNameInput');
const timeZoneSelect = document.getElementById('timeZoneSelect');
const themeSelect = document.getElementById('themeSelect');
const createBtn = document.getElementById('createBtn');
const canvas = document.getElementById('clockPreview');
const ctx = canvas.getContext('2d');
const radius = canvas.height / 2;
ctx.translate(radius, radius);
let offset = 0;

function drawClock(){
  ctx.clearRect(-radius,-radius,canvas.width,canvas.height);
  const now = new Date(new Date().getTime() + offset*3600*1000);
  drawFace(ctx,radius);
  drawNumbers(ctx,radius);
  drawTime(ctx,radius,now);
  requestAnimationFrame(drawClock);
}

function drawFace(ctx,radius){
  ctx.beginPath();
  ctx.arc(0,0,radius,0,2*Math.PI);
  ctx.fillStyle = themeSelect.value==='light'?'#ffffff':''#000000;
  ctx.fill();
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = radius*0.05;
  ctx.stroke();
  ctx.beginPath();
  ctx.arc(0,0,radius*0.05,0,2*Math.PI);
  ctx.fillStyle = '#fff';
  ctx.fill();
}

function drawNumbers(ctx,radius){
  ctx.font = radius*0.15 + "px Poppins";
  ctx.textBaseline="middle";
  ctx.textAlign="center";
  for(let num=1;num<=12;num++){
    const ang=num*Math.PI/6;
    ctx.rotate(ang);
    ctx.translate(0,-radius*0.85);
    ctx.rotate(-ang);
    ctx.fillStyle = themeSelect.value==='light'?'#000':'#fff';
    ctx.fillText(num.toString(),0,0);
    ctx.rotate(ang);
    ctx.translate(0,radius*0.85);
    ctx.rotate(-ang);
  }
}

function drawTime(ctx,radius,now){
  let hour = now.getUTCHours();
  let minute = now.getUTCMinutes();
  let second = now.getUTCSeconds();
  // hour
  hour=hour%12;
  hour=(hour*Math.PI/6)+(minute*Math.PI/(6*60))+(second*Math.PI/(360*60));
  drawHand(ctx,hour,radius*0.5,radius*0.07);
  // minute
  let minuteAngle=(minute*Math.PI/30)+(second*Math.PI/(30*60));
  drawHand(ctx,minuteAngle,radius*0.8,radius*0.07);
  // second
  let secondAngle=(second*Math.PI/30);
  drawHand(ctx,secondAngle,radius*0.9,radius*0.02,'red');
}

function drawHand(ctx,pos,length,width,color='#fff'){
  ctx.beginPath();
  ctx.lineWidth=width;
  ctx.lineCap="round";
  ctx.strokeStyle=color;
  ctx.moveTo(0,0);
  ctx.rotate(pos);
  ctx.lineTo(0,-length);
  ctx.stroke();
  ctx.rotate(-pos);
}

onAuthStateChanged(auth,user=>{
  if(!user) location.href='/login/index.html';
});

timeZoneSelect.addEventListener('change',()=>{ offset=parseInt(timeZoneSelect.value); });
themeSelect.addEventListener('change',()=>{});

drawClock();

// Create button
createBtn.addEventListener('click', async ()=>{
  const name = clockNameInput.value.trim();
  if(!name){ alert('Enter clock name'); return; }
  const user = auth.currentUser;
  if(!user){ alert('Not signed in'); return; }
  const docRef = await addDoc(collection(db,'clocks'),{
    name,
    timeZone: timeZoneSelect.value,
    theme: themeSelect.value,
    ownerUid: user.uid,
    createdAt: new Date().toISOString()
  });
  window.location.href = `/home/dashboard/clock.html?id=${docRef.id}`;
});
</script>
</body>
  </html>
